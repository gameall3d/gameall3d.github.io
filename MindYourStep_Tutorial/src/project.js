System.register([],(function(){"use strict";return{execute:function(){System.register("project:///assets/Scipts/GameManager.ts",["cc","./PlayerController.ts"],(function(e,t){var i,r,s,o,n,a,l,c,p,u,d,h,_,b,y,m,v,f,S,P,T,g,C,I,H;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_dec4:void 0,_dec5:void 0,_dec6:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_descriptor3:void 0,_descriptor4:void 0,_descriptor5:void 0,_temp:void 0,BlockType:void 0,GameState:void 0}),{setters:[function(e){i=e._decorator,r=e.Component,s=e.Prefab,o=e.instantiate,n=e.Node,a=e.LabelComponent,l=e.CCInteger},function(e){c=e.PlayerController}],execute:function(){cc._RF.push(window.module||{},"326d6DtDjZPxJ4SwTMVuYAe","GameManager"),g=i.ccclass,C=i.property,function(e){e[e.BT_NONE=0]="BT_NONE",e[e.BT_STONE=1]="BT_STONE"}(I||(I={})),function(e){e[e.GS_INIT=0]="GS_INIT",e[e.GS_PLAYING=1]="GS_PLAYING",e[e.GS_END=2]="GS_END"}(H||(H={})),e("GameManager",(p=g("GameManager"),u=C({type:s}),d=C({type:l}),h=C({type:n}),_=C({type:c}),b=C({type:a}),p((m=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"cubePrfb",v,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"roadLength",f,babelHelpers.assertThisInitialized(i)),i._road=[],babelHelpers.initializerDefineProperty(i,"startMenu",S,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"playerCtrl",P,babelHelpers.assertThisInitialized(i)),i._curState=H.GS_INIT,babelHelpers.initializerDefineProperty(i,"stepsLabel",T,babelHelpers.assertThisInitialized(i)),i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){this.curState=H.GS_INIT,this.playerCtrl.node.on("JumpEnd",this.onPlayerJumpEnd,this)}},{key:"init",value:function(){this.startMenu.active=!0,this.generateRoad(),this.playerCtrl.setInputActive(!1),this.playerCtrl.node.setPosition(cc.v3()),this.playerCtrl.reset()}},{key:"generateRoad",value:function(){this.node.removeAllChildren(),this._road=[],this._road.push(I.BT_STONE);for(var e=1;e<this.roadLength;e++)this._road[e-1]===I.BT_NONE?this._road.push(I.BT_STONE):this._road.push(Math.floor(2*Math.random()));for(var t=0;t<this._road.length;t++){var i=this.spawnBlockByType(this._road[t]);i&&(this.node.addChild(i),i.setPosition(t,-1.5,0))}}},{key:"spawnBlockByType",value:function(e){var t=null;switch(e){case I.BT_STONE:t=o(this.cubePrfb)}return t}},{key:"onStartButtonClicked",value:function(){this.curState=H.GS_PLAYING}},{key:"checkResult",value:function(e){e<=this.roadLength?this._road[e]==I.BT_NONE&&(this.curState=H.GS_INIT):this.curState=H.GS_INIT}},{key:"onPlayerJumpEnd",value:function(e){this.stepsLabel.string=""+e,this.checkResult(e)}},{key:"curState",set:function(e){var t=this;switch(e){case H.GS_INIT:this.init();break;case H.GS_PLAYING:this.startMenu.active=!1,this.stepsLabel.string="0",setTimeout((function(){t.playerCtrl.setInputActive(!0)}),.1);break;case H.GS_END:}this._curState=e}}]),t}(r),v=babelHelpers.applyDecoratedDescriptor(m.prototype,"cubePrfb",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=babelHelpers.applyDecoratedDescriptor(m.prototype,"roadLength",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),S=babelHelpers.applyDecoratedDescriptor(m.prototype,"startMenu",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=babelHelpers.applyDecoratedDescriptor(m.prototype,"playerCtrl",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=babelHelpers.applyDecoratedDescriptor(m.prototype,"stepsLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=m))||y)),cc._RF.pop()}}})),System.register("project:///assets/Scipts/PlayerController.ts",["cc"],(function(e,t){var i,r,s,o,n,a,l,c,p,u,d,h,_,b,y,m;return e({_dec:void 0,_dec2:void 0,_dec3:void 0,_class:void 0,_class2:void 0,_descriptor:void 0,_descriptor2:void 0,_temp:void 0}),{setters:[function(e){i=e._decorator,r=e.Component,s=e.Vec3,o=e.systemEvent,n=e.SystemEvent,a=e.AnimationComponent,l=e.SkeletalAnimationComponent}],execute:function(){cc._RF.push(window.module||{},"ddfb1tkyx9BEqyM7xmfE5Db","PlayerController"),y=i.ccclass,m=i.property,e("PlayerController",(c=y("PlayerController"),p=m({type:a}),u=m({type:l}),c((h=function(e){function t(){var e,i;babelHelpers.classCallCheck(this,t);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.initializerDefineProperty(i,"BodyAnim",_,babelHelpers.assertThisInitialized(i)),babelHelpers.initializerDefineProperty(i,"CocosAnim",b,babelHelpers.assertThisInitialized(i)),i._startJump=!1,i._jumpStep=0,i._curJumpTime=0,i._jumpTime=.3,i._curJumpSpeed=0,i._curPos=cc.v3(),i._deltaPos=cc.v3(0,0,0),i._targetPos=cc.v3(),i._isMoving=!1,i._curMoveIndex=0,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"start",value:function(){}},{key:"reset",value:function(){this._curMoveIndex=0}},{key:"setInputActive",value:function(e){e?o.on(n.EventType.MOUSE_UP,this.onMouseUp,this):o.off(n.EventType.MOUSE_UP,this.onMouseUp,this)}},{key:"onMouseUp",value:function(e){0===e.getButton()?this.jumpByStep(1):2===e.getButton()&&this.jumpByStep(2)}},{key:"jumpByStep",value:function(e){this._isMoving||(this._startJump=!0,this._jumpStep=e,this._curJumpTime=0,this._curJumpSpeed=this._jumpStep/this._jumpTime,this.node.getPosition(this._curPos),s.add(this._targetPos,this._curPos,cc.v3(this._jumpStep,0,0)),this._isMoving=!0,this.CocosAnim.getState("cocos_anim_jump").speed=3.5,this.CocosAnim.play("cocos_anim_jump"),1===e||2===e&&this.BodyAnim.play("twoStep"),this._curMoveIndex+=e)}},{key:"onOnceJumpEnd",value:function(){this._isMoving=!1,this.CocosAnim.play("cocos_anim_idle"),this.node.emit("JumpEnd",this._curMoveIndex)}},{key:"update",value:function(e){this._startJump&&(this._curJumpTime+=e,this._curJumpTime>this._jumpTime?(this.node.setPosition(this._targetPos),this._startJump=!1,this.onOnceJumpEnd()):(this.node.getPosition(this._curPos),this._deltaPos.x=this._curJumpSpeed*e,s.add(this._curPos,this._curPos,this._deltaPos),this.node.setPosition(this._curPos)))}}]),t}(r),_=babelHelpers.applyDecoratedDescriptor(h.prototype,"BodyAnim",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=babelHelpers.applyDecoratedDescriptor(h.prototype,"CocosAnim",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=h))||d)),cc._RF.pop()}}}))}}}));
